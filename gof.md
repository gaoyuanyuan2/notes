# 设计模式

## 创建型模式:

单例模式、工厂模式、抽象工厂模式、建造者模式、原型模式。

结构型模式:适配器模式、桥接模式、装饰模式、组合模式、外观模式，享元模式，代理模式。

## 行为型模式:

模版方法模式、命令模式、迭代器模式、观察者模式、中介者模式、备忘录模式、解释器模式、状态模式、策略模式、职责链模式、访问者模式。

## 1、单例模式: Spring每个Bean默认单例、SpringMVC控制器也是单例数据库连接他一般也是单例

1.  饿汉式(线程安全，调用效率高。但是,不能延时加载。)懒汉式(线程安全,调用效率不高。但是,可以延时加载。)其他:

2.  双重检测锁式(由于JVM底层内部模型原因,偶尔会出问题。不建议使用)静态内部类式(线程安全,调用效率高。但是 ,可以延时加载)

3.  枚举式(线程安全,调用效率高,不能延时加载。并且可以天然的防止反射和反序列化漏洞!)

4.  如何选用?

1)  单例对象占用资源少,不需要延时加载。

枚举式好于饿汉式

2)  单例对象占用资源大，需要延时加载。

静态内部类式好于懒汉式


|模式|耗时|
|:--:|:--:|
|饿汉式|22ms|
|懒汉式|636ms|
|静态内部类式|28ms|
|枚举式|32ms|
|双重检查锁式|65ms|


##  2、工厂模式:实例化对象

1.  原则

1)  OCP (开闭原则, Open-Closed Principle) :一个软件的实体应当对扩 展开放，对修改关闭。

2)  DIP (依赖倒转原则, Dependence Inversion Principle ) : 要针对接口编程不要针对实现编程。

3)  LoD (迪米特法则, Law of Demeter) : 只与你直接的朋友通信,而避免和陌生人通信。

2. 简单工厂模式

3. 工厂方法模式

4.  抽象工厂模式

eg：多个业务品种、分类高中低端汽车不同搭配

## 3、建造者模式:复杂对象

1.  应用场景

1)  StringBuilder append方法

2)  SQL中的PreparedStatement 

3)  DOM中DomBuilder、SAXBuilder

## 4、原型模式

克隆拷贝，数据复用

## 5、结构性模式

关注对象和类的组织

## 6、配器模式

## 7、代理模式

1.  静态代理

2.  动态代理(动态生成代理类)

javassist字节码操作库实现

CGLIB

ASM(底层使用指令,可维护性较差)

JDK自带的动态代理 java.lang.reflect.Proxy.

可以通过invoke方法文现对真义角色的代理访问。

每次通过Proxy生成代理类对象对象时都要指定对应的处理器对象

3.  开发框架中应用场景

1)  struts2中拦截器的实现数埚库连接池关闭处理

2)  Hibernate中延时加载的实现mybatis中实现拦截盟插件AspectJ的实现

3)  spring中AOP的实现

4)  日志栏截

5)  声明式事务处理web service

6)  RMI远程方法调用

## 8、桥接模式多层继承(二维) 

eg: 电脑类放了品牌属性

## 9、组合模式(区别于组合)树形结构

1.应用场景

1)  操作系统的资源管理器

2)  GUI中的容器层次图

3)  XML文件解析

4)  OA系统中,组织结构的处理

5)  Junit单元测试框架

底层设计就是典型的组合模式, TestCase(叶子)、TestUnite(容器)Test接口(抽象)

## 10、装饰模式

1.  实现细节

1)  Component抽象构件角色

真实对象和装饰对象有相同的接口。这样,客户端对象就能够以与真实对象相同的方式同装饰对象交互。

2)  ConcreteComponent具体构件角色(真实对象)

io流中的FileInputStream. FileOutputStream

3)  Decorator装饰角色

持有一个抽象构件的引用。装饰对象接受所有客户端的请求,并把这些请求转发给真实的对象, 这样，就能在真实对象调用前后增加新的功能。

4)  ConcreteDecorator具体装饰角色

负责给构件对象增加新的责任。

2.  动态的为一个对象增加新的功能

装饰模式是一种用于代替继承的技术,无须通过继承增加子类就能扩展对象的新功能。使用对象的关联关系代替继承关系,更加灵活，同时避免类型体系的快速膨胀。

## 11、外观模式(迪米特法则) 

JDBC封装后的, commons提供的DBUtils类，Hibernate提供的工具类、Spring JDBC工具类等

## 12、享元模式

围棋共享内部,不能共享外部。

内存属于稀缺资源,不要随便浪费。如果有很多个完全相同或相似的对象,我们可以通过享元模式,节省内存。

## 13、行为型模式

## 14、责任链模式

## 15、 迭代器模式(平时不常用)

内部类

## 16、 中介模式

1)  总经理和部门经理(之和总经理打交道)

2)  MVC模式(其中的C ,控制器就是一个中介者对象。 M和V都和他打交道)

3)  窗口游戏程序,窗口软件开发中窗口对象也是一个中介者对象

4)  图形界面开发GUI中,多个组件之间的交互,可以通过引入一个中介者对象来解决,可以是整体的窗口对象或者DOM对象Java.lang.reflect.Method#invoke()

## 17、命令模式

Struts2中, action的整个调用过程中就有命令模式。数据库事务机制的底层实现命令的撤销和恢复。

#### 18、解释器模式

1) EL表达式的处理

2) 正则表达式解释器

3) SQL语法的解释器数学表达式解析器

## 19、访问者模式

开发中的场景(应用范围非常窄,了解即可) 

XML文档解析器设计编译器的设计

复杂集合对象的处理

## 20、策略模式

不同用户的报价策略

JavSE中GUI编程中,布局管理

Spring框架中, Resource接口,资源访问策略javax.servlet.http.HttpServlet#service()

## 21、模板方法模式

## 22、状态模式

用于解决系统中复杂对象的状态转换以及不同状态下行为的封装问题结构:

Context环境类

环境类中维护一个State对象 ,他是定义了当前的状态。State抽象状态类

ConcreteState具体状态类

每一个类封装了一个状态对应的行为

## 23、观察者模式(广播)

1.  开发中常见的场景

1)  游戏画面同步

2)  聊天室程序的,服务器转发给所有客户端

3)  网络游戏 多人联机对战场景中,服务器将客户端的状态进行分发

4)  邮件订阅

5)  Servlet中,监听器的实现Android中,广播机制

6)  JDK的AWT中事件处理模型基于观察者模式的委派事件模型(Delegation EventModel)

7)  事件监听 群发某商品打折信息

## 24、备忘录模式

1.  场景

1)  录入大批人员资料。正在录入当前人资料时,发现上一个人录错了

此时需要恢复上一个人的资料,再进行修改。

2)  Word文档编辑时,忽然电脑死机或断电,再打开时,可以看到word提示你恢复到以前的文档

管理系统中,公文撤回功能。公文发送出去后,想撤回来。 


















