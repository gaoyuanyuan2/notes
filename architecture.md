# 架构

## 1、	网站架构模式

1.	分层

2.	分割

3.	分布式：应用和服务、静态资源、数据存储、计算

4.	集群

5.	缓存：CND（最近服务器、缓存静态资源） 、反向代理（先服务代理服务器、静态资源）、本地缓存、分布式缓存

6.	异步：提高系统可用性、加快网站响应速度、消除并发访问高峰

7.	冗余

8.	安全

9.	自动化

## 2、	核心架构要素

1.性能

前端：浏览器缓存、页面压缩、合理布局、减少cookie传输、CDN、减少http请求，启用压缩，css放上面js放下面，反向代理，防重复提交

应用服务器：应用服务器本地缓存、分布式缓存、集群、缓存内存热点数据、异步消息队列等待处理，减少事物锁的时间。

代码层：多线程、改善内存处理手段优化性能、资源复用（连接池）、数据结构、垃圾回收

数据库：索引、缓存、sql优化、NoSQL数据库

存储层：固态硬盘

网络

2.可用性：预发布验证、自动化测试、自动化发布、灰度发布

3.伸缩性

4.扩展性

5.安全性

## 3、负载均衡

http重定向(下载);DNS负载均衡;反向代理负载均衡;IP负载均衡(LVS-NAT);直接路由(LVS-DR)；IP隧道(LVS-TUN)

1.Nginx实现多Tomcat负载均衡

2.Nginx实现静态资源分离 

3.Nginx+Tomcat+Redis实现session共享（分布式session）

4.依次启动Redis（静态页面的缓存）、Tomcat、Nginx（静态内容服务和代理服务器），访问Nginx
最直接的表现就是减轻数据库的压力。避免因为数据读取频繁或过大而影响数据库性能，降低程序宕机的可能性

## 4、分布式、集群环境中，缓存如何刷新，如何保持同步？

A、缓存如何刷新？ 

1、定时刷新  

2、主动刷新覆盖   ，每个缓存框架都有自带的刷新机制，或者说缓存失效机制
，就拿Redis和 Ehcache举例， 他们都有自带的过期机制，另外主动刷新覆盖时，只需获取对应的key进行数据的覆盖即可

B、缓存如何保持同步？ 
 
这个redis有自带的集群同步机制，即复制功能，具体参考：基于Redis分布式缓存实现   

## 5、应用服务和数据服务分离

使用缓存改善性能；使用应用服务器集群；数据库读写分离；反向代理和CDN加速（加快系统的 访问速度）；
分布式文件系统和分布式数据库；使用NoSQL和搜索引擎；业务拆分；分布式服务；

## 6、Java分布式应用技术基础

消息队列架构：消息对列通过消息对象分解系统耦合性，不同子系统处理同一个消息

服务框架架构：

服务框架通过接口分解系统耦合性，不同子系统通过相同的接口描述进行服务启用

服务框架是一个点对点模型

服务框架面向同构系统

适合：移动应用、互联网应用、外部系统

服务总线架构：

通过接口分解系统耦合性，不同子系统通过相同的接口描述进行服务启用

服务总线是一个总线式的模型

服务总线面向同构、异构系统

适合：内部系统

## 7、分布式架构下系统间交互的5种通信模式

request/response模式（同步模式）：客户端发起请求一直阻塞到服务端返回请求为止。

Callback（异步模式）：客户端发送一个RPC请求给服务器，服务端处理后再发送一个消息给消息发送端提供的callback端点，此类情况非常合适以下场景：A组件发送RPC请求给B，B处理完成后，需要通知A组件做后续处理。

Future模式：客户端发送完请求后，继续做自己的事情，返回一个包含消息结果的Future对象。客户端需要使用返回结果时，使用Future对象的.get(),如果此时没有结果返回的话，会一直阻塞到有结果返回为止。

OneWay模式：客户端调用完继续执行，不管接收端是否成功。

Reliable模式：为保证通信可靠，将借助于消息中心来实现消息的可靠送达，请求将做持久化存储，在接收方在线时做送达，并由消息中心保证异常重试。

## 8、流数据

流是个抽象的概念,是对输入输出设备的抽象, Java程序中,对于数据的输
入/输出操作都是以“流”的方式进行。设备可以是文件,网络,内存等。
流数据是一组顺序、大量、快速、连续到达的数据序列,一-般情况下数据流
可被视为一个随时间延续而无限增长的动态数据集合。
流数据:实时(realtime)+无界(unbounded)


 ![实时流计算架构](/img/18.png) 






